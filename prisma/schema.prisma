generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "postgresql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

enum Role {
  TALENT
  EMPLOYER
  ADMIN
  AUTHOR
}

enum Gender {
  MALE
  FEMALE
  OTHER
  PREFER_NOT_TO_SAY
}

enum AvailabilityStatus {
  AVAILABLE
  BUSY
  NEGOTIABLE
}

enum ProfileVisibility {
  PUBLIC
  PRIVATE
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model User {
  id             String    @id @default(cuid())
  name           String?
  companyName    String?
  email          String    @unique
  emailVerified  DateTime?
  hashedPassword String?
  image          String?
  role           Role      @default(TALENT)
  bio           String?   @db.Text
  isSuspended    Boolean   @default(false)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  accounts Account[]
  sessions Session[]

  wallet              Wallet?
  transactions        Transaction[]    @relation("UserTransactions")
  payouts             PayoutRequest[]

  coursesOwned        Course[]         @relation("InstructorCourses")
  enrollments         Enrollment[]

  disputesCreated     Dispute[]        @relation("DisputeCreator")
  disputesAgainst     Dispute[]        @relation("DisputeTarget")

  talentProfile TalentProfile?
  tickets             Ticket[]
  reportsMade         Report[]  @relation("Reporter")
  reportsReceived     Report[]  @relation("ReportedUser")
  blogPosts     BlogPost[]    @relation("PostAuthor")
  comments      Comment[]

  employerProfile EmployerProfile?
  activitiesPerformed ActivityLog[] @relation("ActorActivities")
  activitiesReceived  ActivityLog[] @relation("TargetActivities")
  notifications       Notification[]
  createdAnnouncements Announcement[] @relation("CreatedAnnouncements")
  successStories SuccessStory[]
}

model BlogCategory {
  id          String      @id @default(cuid())
  name        String      @unique
  slug        String      @unique 
  description String?
  
  posts       BlogPost[]
  
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
}

model BlogPost {
  id          String      @id @default(cuid())
  
  title       String
  slug        String      @unique 
  excerpt     String?     @db.Text 
  content     String      @db.Text 
  coverImage  String?     

  metaTitle       String?
  metaDescription String?  @db.Text
  
  isPublished Boolean     @default(false)
  publishedAt DateTime?
  
  authorId    String
  author      User        @relation("PostAuthor", fields: [authorId], references: [id])
  customByline String?
  
  categoryId  String?
  category    BlogCategory? @relation(fields: [categoryId], references: [id])
  
  comments    Comment[]

  viewCount   Int         @default(0)
  
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  
  @@index([authorId])
  @@index([categoryId])
}

model Comment {
  id          String      @id @default(cuid())
  content     String      @db.Text
  
  userId      String
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  postId      String
  post        BlogPost    @relation(fields: [postId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt 
  
  @@index([userId])
  @@index([postId])
}

model SuccessStory {
  id             String   @id @default(cuid())
  title          String  
  slug           String   @unique 
  excerpt        String   @db.Text
  content        String   @db.Text
  coverImage     String? 
  featured       Boolean  @default(false) 
  category       String  
  
  talentId       String?
  talent         User?    @relation(fields: [talentId], references: [id])
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([category])
  @@index([featured])
}

model Ticket {
  id          String   @id @default(cuid())
  
  subject     String
  message     String   @db.Text 
  
  status      TicketStatus   @default(OPEN)
  priority    TicketPriority @default(MEDIUM)
  
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  adminNotes  String?  @db.Text

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Announcement {
  id          String   @id @default(cuid())
  
  title       String
  message     String   @db.Text
  
  audience    AnnouncementAudience @default(ALL) 
  
  sendAsEmail Boolean  @default(false)
  
  creatorId   String
  creator     User     @relation("CreatedAnnouncements", fields: [creatorId], references: [id])
  
  createdAt   DateTime @default(now())
}

model Notification {
  id          String   @id @default(cuid())
  
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  title       String
  message     String   @db.Text
  isRead      Boolean  @default(false)
  
  type        NotificationType @default(SYSTEM)
  
  link        String?
  
  createdAt   DateTime @default(now())
}

model SystemSettings {
  id                String   @id @default("default_settings") 
  
  siteName          String   @default("Ambassador Talent Agency")
  supportEmail      String   @default("support@ambassador.com")
  maintenanceMode   Boolean  @default(false)
  
  facebookUrl       String?
  instagramUrl      String?
  twitterUrl        String?
  linkedinUrl       String?

  termsOfService    String?  @db.Text
  privacyPolicy     String?  @db.Text
  cookiePolicy      String?  @db.Text

  emailTemplates    Json?    

  updatedAt         DateTime @updatedAt
}

model Wallet {
  id          String   @id @default(cuid())
  userId      String   @unique
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  balance     Float    @default(0.0) 
  currency    String   @default("NGN")
  
  totalEarned Float    @default(0.0)
  totalSpent  Float    @default(0.0)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Transaction {
  id              String          @id @default(cuid())
  userId          String
  user            User            @relation("UserTransactions", fields: [userId], references: [id])
  
  amount          Float
  currency        String          @default("NGN")
  type            TransactionType
  status          TransactionStatus @default(PENDING)
  
  reference       String?         @unique // Paystack Reference
  description     String?
  
  // LINKING: Knowing what this money is for
  jobId           String?
  applicationId   String?         @unique // One escrow payment per application
  application     Application?    @relation(fields: [applicationId], references: [id])
  
  courseId        String?
  
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
}

model Dispute {
  id              String   @id @default(cuid())
  applicationId   String   @unique
  application     Application @relation(fields: [applicationId], references: [id])
  
  creatorId       String   // Who started the dispute?
  creator         User     @relation("DisputeCreator", fields: [creatorId], references: [id])
  
  targetId        String   // Who is being reported?
  target          User     @relation("DisputeTarget", fields: [targetId], references: [id])
  
  reason          String   @db.Text
  adminNotes      String?  @db.Text
  
  status          DisputeStatus @default(OPEN)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model PayoutRequest {
  id              String        @id @default(cuid())
  userId          String
  user            User          @relation(fields: [userId], references: [id])
  
  amount          Float
  currency        String        @default("NGN")
  status          PayoutStatus  @default(PENDING)
  
  bankName        String
  accountNumber   String
  accountName     String
  
  rejectionReason String?
  processedAt     DateTime?

  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
}

model Course {
  id           String   @id @default(cuid())
  title        String
  description  String   @db.Text
  thumbnailUrl String?
  
  instructorId String
  instructor   User     @relation("InstructorCourses", fields: [instructorId], references: [id])
  
  price        Float    @default(0.0)
  isPublished  Boolean  @default(false)
  
  modules      Module[]
  enrollments  Enrollment[]
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Module {
  id          String   @id @default(cuid())
  courseId    String
  course      Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  title       String
  position    Int
  lessons     Lesson[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Lesson {
  id            String   @id @default(cuid())
  moduleId      String
  module        Module   @relation(fields: [moduleId], references: [id], onDelete: Cascade)
  title         String
  videoUrl      String?
  content       String?  @db.Text
  position      Int
  isFreePreview Boolean  @default(false)
  
  userProgress  UserProgress[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Enrollment {
  id         String   @id @default(cuid())
  userId     String
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  courseId   String
  course     Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  amountPaid Float    @default(0.0)
  enrolledAt DateTime @default(now())

  @@unique([userId, courseId])
}

model UserProgress {
  id          String   @id @default(cuid())
  userId      String
  lessonId    String
  lesson      Lesson   @relation(fields: [lessonId], references: [id], onDelete: Cascade)
  isCompleted Boolean  @default(false)
  updatedAt   DateTime @updatedAt
  
  @@unique([userId, lessonId])
}

model PasswordResetToken {
  id      String   @id @default(cuid())
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
}

model TalentProfile {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  stageName   String?   @db.VarChar(255)
  dateOfBirth DateTime?
  gender      Gender?
  country     String?
  city        String?
  phone       String?   @unique
  bio         String?   @db.Text

  height    Float?
  weight    Float?
  bodyType  String?
  eyeColor  String?
  hairColor String?
  ethnicity String?
  languages String[]
  isVerified Boolean @default(false)

  talentCategories   String[]
  yearsOfExperience  Int?
  skills             String[]
  unionMemberships   String[]
  availabilityStatus AvailabilityStatus @default(AVAILABLE)
  willingToTravel    Boolean            @default(false)
  headline           String?
  isPublic           Boolean            @default(true)

  socialMediaLinks       Json?
  externalPortfolioLinks String[]
  applications           Application[]

  profileVisibility     ProfileVisibility @default(PUBLIC)
  contactInfoVisibility Json?
  profileCompletion     Int               @default(0)

  photos       PortfolioPhoto[]
  videos       PortfolioVideo[]
  audioSamples PortfolioAudio[]
  documents    PortfolioDocument[]
  experience   ExperienceCredit[]
  savedJobs    SavedJob[]
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @default(now()) @updatedAt

  savedBy        SavedTalent[]
  shortlistItems ShortlistItem[]
}

model PortfolioPhoto {
  id              String        @id @default(cuid())
  talentProfileId String
  talentProfile   TalentProfile @relation(fields: [talentProfileId], references: [id], onDelete: Cascade)
  url             String
  publicId        String
  title           String?
  description     String?
  createdAt       DateTime      @default(now())

  @@index([talentProfileId])
}

model PortfolioVideo {
  id              String        @id @default(cuid())
  talentProfileId String
  talentProfile   TalentProfile @relation(fields: [talentProfileId], references: [id], onDelete: Cascade)
  url             String
  publicId        String?
  title           String?
  description     String?
  createdAt       DateTime      @default(now())

  @@index([talentProfileId])
}

model PortfolioAudio {
  id              String        @id @default(cuid())
  talentProfileId String
  talentProfile   TalentProfile @relation(fields: [talentProfileId], references: [id], onDelete: Cascade)
  url             String
  publicId        String
  title           String?
  description     String?
  createdAt       DateTime      @default(now())

  @@index([talentProfileId])
}

model PortfolioDocument {
  id              String        @id @default(cuid())
  talentProfileId String
  talentProfile   TalentProfile @relation(fields: [talentProfileId], references: [id], onDelete: Cascade)
  url             String
  publicId        String
  fileName        String
  createdAt       DateTime      @default(now())

  @@index([talentProfileId])
}

model ExperienceCredit {
  id              String        @id @default(cuid())
  talentProfileId String
  talentProfile   TalentProfile @relation(fields: [talentProfileId], references: [id], onDelete: Cascade)

  projectTitle      String
  role              String
  year              Int
  productionCompany String?
  description       String?  @db.Text
  createdAt         DateTime @default(now())

  @@index([talentProfileId])
}

model EmployerProfile {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  companyLogoUrl     String?
  companyDescription String? @db.Text
  industryType       String?
  country            String?
  city               String?
  websiteUrl         String?
  socialMediaLinks   Json?
  companySize        Int?
  foundedYear        Int?
  contactInfo        Json?
  companyName String?
  isVerified     Boolean @default(false)
  verificationRequests VerificationRequest[]

  jobs Job[]

  savedTalents SavedTalent[]
  shortlists   Shortlist[]
}

model Job {
  id         String          @id @default(cuid())
  employerId String
  employer   EmployerProfile @relation(fields: [employerId], references: [id], onDelete: Cascade)

  title       String
  description String @db.Text
  category    String
  positions   Int    @default(1)

  roleDescription String?  @db.Text
  skills          String[]
  minAge          Int?
  maxAge          Int?
  gender          String?
  ethnicity       String?

  location    String
  projectType String
  duration    String?
  startDate   DateTime?
  reports             Report[]

  isPaid          Boolean   @default(true)
  salaryMin       Int?
  salaryMax       Int?
  currency        String    @default("NGN")
  deadline        DateTime?
  auditionDetails String?   @db.Text

  attachments  String[]
  isFeatured   Boolean       @default(false)
  views        Int           @default(0)
  status       JobStatus     @default(DRAFT)
  applications Application[]

  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  savedBy   SavedJob[]

  @@index([employerId])
}

model Report {
  id          String   @id @default(cuid())
  
  reason      ReportReason
  details     String?  @db.Text
  status      ReportStatus @default(PENDING)

  // Who sent the report?
  reporterId  String
  reporter    User     @relation("Reporter", fields: [reporterId], references: [id])

  // What did they report? (Nullable fields: A report targets EITHER a Job OR a User)
  targetJobId String?
  targetJob   Job?     @relation(fields: [targetJobId], references: [id])

  targetUserId String?
  targetUser   User?   @relation("ReportedUser", fields: [targetUserId], references: [id])

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model SavedJob {
  id        String        @id @default(cuid())
  talentId  String
  talent    TalentProfile @relation(fields: [talentId], references: [id], onDelete: Cascade)
  jobId     String
  job       Job           @relation(fields: [jobId], references: [id], onDelete: Cascade)
  createdAt DateTime      @default(now())

  @@unique([talentId, jobId])
  @@index([talentId])
}

model Application {
  id String @id @default(cuid())

  jobId String
  job   Job    @relation(fields: [jobId], references: [id], onDelete: Cascade)

  talentId String
  talent   TalentProfile @relation(fields: [talentId], references: [id], onDelete: Cascade)

  coverLetter String?           @db.Text
  attachments String[]
  status      ApplicationStatus @default(SUBMITTED)
  notes       String?           @db.Text

  markedCompleteAt    DateTime?
  transaction         Transaction? 
  dispute             Dispute?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([jobId, talentId])
  @@index([jobId])
  @@index([talentId])
}

model SavedTalent {
  id String @id @default(cuid())

  employerId String
  employer   EmployerProfile @relation(fields: [employerId], references: [id], onDelete: Cascade)

  talentId String
  talent   TalentProfile @relation(fields: [talentId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@unique([employerId, talentId])
  @@index([employerId])
}

model Shortlist {
  id         String          @id @default(cuid())
  name       String
  employerId String
  employer   EmployerProfile @relation(fields: [employerId], references: [id], onDelete: Cascade)

  items ShortlistItem[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ShortlistItem {
  id String @id @default(cuid())

  shortlistId String
  shortlist   Shortlist @relation(fields: [shortlistId], references: [id], onDelete: Cascade)

  talentId String
  talent   TalentProfile @relation(fields: [talentId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@unique([shortlistId, talentId])
}

model VerificationRequest {
  id          String   @id @default(cuid())
  
  employerId  String
  employer    EmployerProfile @relation(fields: [employerId], references: [id], onDelete: Cascade)
  
  documentUrl String  
  documentType String? 
  status      VerificationStatus @default(PENDING)
  
  rejectionReason String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([employerId])
}

model ActivityLog {
  id           String   @id @default(cuid())
  
  actorId      String
  actor        User     @relation("ActorActivities", fields: [actorId], references: [id], onDelete: Cascade)

  targetUserId String?
  targetUser   User?    @relation("TargetActivities", fields: [targetUserId], references: [id], onDelete: Cascade)

  action       String  
  details      String?  @db.Text
  
  createdAt    DateTime @default(now())

  @@index([actorId])
  @@index([targetUserId])
}

enum VerificationStatus {
  PENDING
  APPROVED
  REJECTED
}

enum ApplicationStatus {
  SUBMITTED
  REVIEWING
  SHORTLISTED
  INTERVIEW
  REJECTED
  PAYMENT_PENDING
  HIRED
  JOB_COMPLETED
  PAID
  DISPUTED
  REFUNDED
}

enum JobStatus {
  DRAFT
  PENDING
  PUBLISHED
  REJECTED
  CLOSED
  ARCHIVED
}

enum TransactionType {
  DEPOSIT          
  WITHDRAWAL       
  JOB_FEE           
  COURSE_PURCHASE   
  COMMISSION       
  PAYMENT_RELEASED  
}

enum TransactionStatus {
  PENDING
  SUCCESSFUL
  FAILED
}

enum PayoutStatus {
  PENDING
  APPROVED
  REJECTED
  PROCESSED
}

enum DisputeStatus {
  OPEN
  RESOLVED_PAY_TALENT  
  RESOLVED_REFUND     
}

enum AnnouncementAudience {
  ALL
  TALENT
  EMPLOYER
}

enum NotificationType {
  SYSTEM
  APPLICATION
  JOB
  PAYMENT
  SECURITY
}

enum TicketStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED
}

enum TicketPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum ReportReason {
  SCAM
  SPAM
  INAPPROPRIATE
  HARASSMENT
  OFFENSIVE_CONTENT
  OTHER
}

enum ReportStatus {
  PENDING
  RESOLVED
  DISMISSED
}